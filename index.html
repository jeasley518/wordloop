<!-- Same HTML layout as before, keeping style, title, buttons, history, etc. -->

<script>
  let currentWord = 'loop';
  let startWord = 'loop';
  let score = 0;
  let xp = 0;
  let level = 1;
  let timeLeft = 120;
  let timerInterval;
  const usedWords = new Set();
  const wordHistory = [];

  const currentWordDisplay = document.getElementById('current-word');
  const input = document.getElementById('word-input');
  const scoreboard = document.getElementById('scoreboard');
  const timerDisplay = document.getElementById('timer');
  const levelDisplay = document.getElementById('level-display');
  const startWordDisplay = document.getElementById('start-word');
  const wordHistoryDisplay = document.getElementById('word-history');
  const definitionDisplay = document.getElementById('definition');

  function updateDisplays() {
    scoreboard.textContent = `Score: ${score}`;
    levelDisplay.textContent = `Level: ${level} | XP: ${xp % 100} / 100`;
    startWordDisplay.textContent = `Start word: ${startWord.toUpperCase()}`;
  }

  function updateHistory() {
    wordHistoryDisplay.innerHTML = '';
    wordHistory.forEach(word => {
      const span = document.createElement('span');
      span.textContent = word.toUpperCase();
      span.onclick = () => lookupDefinition(word);
      wordHistoryDisplay.appendChild(span);
    });
  }

  async function isValidWord(word) {
    try {
      const res = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${word}`);
      return res.ok;
    } catch {
      return false;
    }
  }

  async function lookupDefinition(word) {
    try {
      const res = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${word}`);
      if (res.ok) {
        const data = await res.json();
        const meaning = data[0].meanings[0].definitions[0].definition;
        definitionDisplay.textContent = `${word.toUpperCase()}: ${meaning}`;
      } else {
        definitionDisplay.textContent = `No definition found for ${word.toUpperCase()}.`;
      }
    } catch {
      definitionDisplay.textContent = `Could not load definition.`;
    }
  }

  function resetTimer() {
    clearInterval(timerInterval);
    timeLeft = 120;
    startTimer();
  }

  function startTimer() {
    timerDisplay.textContent = `Time left: ${timeLeft}s`;
    timerInterval = setInterval(() => {
      timeLeft--;
      timerDisplay.textContent = `Time left: ${timeLeft}s`;
      if (timeLeft <= 0) {
        clearInterval(timerInterval);
        alert(`Time's up! Your score: ${score}`);
      }
    }, 1000);
  }

  function resetGame(newWord = 'loop') {
    clearInterval(timerInterval);
    currentWord = newWord;
    startWord = newWord;
    score = 0;
    xp = 0;
    level = 1;
    timeLeft = 120;
    usedWords.clear();
    wordHistory.length = 0;
    currentWordDisplay.textContent = currentWord.toUpperCase();
    input.value = '';
    updateDisplays();
    updateHistory();
    startTimer();
  }

  document.getElementById('submit-btn').addEventListener('click', async () => {
    const nextWord = input.value.toLowerCase();
    if (
      nextWord.length === currentWord.length &&
      nextWord !== currentWord &&
      [...nextWord].filter((ch, i) => ch !== currentWord[i]).length === 1 &&
      !usedWords.has(nextWord) &&
      await isValidWord(nextWord)
    ) {
      currentWord = nextWord;
      currentWordDisplay.textContent = currentWord.toUpperCase();
      usedWords.add(nextWord);
      wordHistory.push(nextWord);
      updateHistory();
      score++;
      xp += 10;
      if (xp >= level * 100) {
        level++;
        resetTimer();
      }
      updateDisplays();
      input.value = '';
      definitionDisplay.textContent = '';
    } else {
      alert('Invalid word! Must be real, same length, and one letter different.');
    }
  });

  document.getElementById('new-word-btn').addEventListener('click', () => {
    const startWords = ['loop','game','word','test','code','fast','hope','love','fish','bake','rain'];
    const randomWord = startWords[Math.floor(Math.random() * startWords.length)];
    resetGame(randomWord);
  });

  resetGame(currentWord);
</script>